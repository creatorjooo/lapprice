services:
  - type: web
    name: lapprice
    runtime: node
    plan: free
    region: singapore
    nodeVersion: "20"
    buildCommand: npm install --include=dev && npx vite build
    startCommand: node server/index.js
    envVars:
      # 네이버 쇼핑 API
      - key: NAVER_CLIENT_ID
        sync: false
      - key: NAVER_CLIENT_SECRET
        sync: false
      # 쿠팡 파트너스 API
      - key: COUPANG_ACCESS_KEY
        sync: false
      - key: COUPANG_SECRET_KEY
        sync: false
      # 11번가 Open API
      - key: ELEVENTH_ST_API_KEY
        sync: false
      # 서버 설정
      - key: PORT
        value: "10000"
      - key: NODE_ENV
        value: production
      - key: CACHE_TTL
        value: "300"
      # 어필리에이트
      - key: AFFILIATE_ENABLED
        value: "true"
      - key: COUPANG_AFFILIATE_SUBID_PREFIX
        value: lapprice
      - key: DEEPLINK_CACHE_TTL
        value: "86400"
      - key: DEEPLINK_MAX_REQUESTS_PER_MIN
        value: "42"
      - key: DEEPLINK_LOCAL_COOLDOWN_MS
        value: "60000"
      - key: REDIS_URL
        sync: false
      - key: REDIS_PREFIX
        value: lapprice
      - key: VITE_AFFILIATE_PREFETCH
        value: "false"
      # 관리자
      - key: ADMIN_PASSWORD
        sync: false
      # 자동 동기화
      - key: AUTO_SYNC_ENABLED
        value: "true"
      - key: SYNC_INTERVAL_HOURS
        value: "24"
      # 가격 검증 파이프라인
      - key: VERIFIED_ONLY_MODE
        value: "false"
      - key: CLICK_TIME_VERIFY
        value: "true"
      - key: VERIFICATION_STALE_MINUTES
        value: "360"
      - key: VERIFICATION_TIMEOUT_MS
        value: "6500"
      - key: STRICT_PRICE_GUARD
        value: "true"
      - key: ALLOW_DEGRADED_REDIRECT
        value: "false"
      - key: DISPLAY_PRICE_FRESH_MINUTES
        value: "360"
      - key: LISTING_PRICE_TTL_SEC
        value: "300"
      - key: CLICK_VERIFY_TIMEOUT_MS
        value: "2500"
      - key: PRICE_TOKEN_SECRET
        sync: false
      - key: NAVER_VERIFY_MIN_INTERVAL_MS
        value: "120"
      - key: COUPANG_VERIFY_MIN_INTERVAL_MS
        value: "120"
      - key: NAVER_FETCH_TIMEOUT_MS
        value: "12000"
      - key: COUPANG_SEARCH_DEEPLINK_ENABLED
        value: "false"
      # 전 플랫폼 스토어 확장
      - key: ENABLE_ALL_PLATFORM_ENRICH
        value: "true"
      - key: PLATFORM_ENRICH_RESULT_LIMIT
        value: "12"
      - key: PLATFORM_STORES_PER_SOURCE
        value: "2"
      - key: PLATFORM_MATCH_SCORE_THRESHOLD
        value: "58"
      - key: PLATFORM_ENRICH_TIMEOUT_MS
        value: "12000"
      - key: PLATFORM_ENRICH_CONCURRENCY
        value: "3"
      # 썸네일 외부 캐시 (선택)
      - key: IMAGE_CACHE_PROVIDER
        sync: false
      - key: IMAGE_CACHE_S3_ENDPOINT
        sync: false
      - key: IMAGE_CACHE_S3_BUCKET
        sync: false
      - key: IMAGE_CACHE_S3_REGION
        value: "auto"
      - key: IMAGE_CACHE_S3_ACCESS_KEY
        sync: false
      - key: IMAGE_CACHE_S3_SECRET_KEY
        sync: false
      - key: IMAGE_CACHE_PUBLIC_BASE_URL
        sync: false
